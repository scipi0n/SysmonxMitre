<Sysmon schemaversion="4.60">
<HashAlgorithms>*</HashAlgorithms>
<!-- This now also determines the file names of the files preserved (String) -->
<CheckRevocation>False</CheckRevocation>
<!-- Setting this to true might impact performance -->
<DnsLookup>False</DnsLookup>
<!-- Disables lookup behavior, default is True (Boolean) -->
<ArchiveDirectory>Sysmon</ArchiveDirectory>
<!-- Sets the name of the directory in the C:\ root where preserved files will be saved (String)-->
<EventFiltering>
<!--hola-->
<RuleGroup groupRelation="or" name="1_include">
<ProcessCreate onmatch="include">
<CommandLine condition="contains any" name="T1558.001">privilege::debug;kerberos::golden</CommandLine><Image condition="contains" name="T1558.001">mimikatz.exe</Image><Image condition="contains" name="T1558.001">inject.exe</Image><Image condition="contains" name="T1558.001">rundll32.exe</Image><Image condition="contains" name="T1558.001">psexec.exe</Image><Image condition="contains" name="T1558.001">wmic.exe</Image><Image condition="contains" name="T1558.001">net.exe</Image><Image condition="contains" name="T1558.001">dsquery.exe</Image><Image condition="contains" name="T1558.001">runas.exe</Image><Image condition="contains" name="T1558.001">klist.exe</Image>
<Image condition="contains" name="T1055.001">mavinject.exe</Image>
<CommandLine condition="contains any" name="T1550.002">sekurlsa::tickets;kerberos::ptt</CommandLine>
<Image condition="contains" name="T1550.002">mimikatz.exe</Image><Image condition="contains" name="T1550.002">rubeus.exe</Image><Image condition="contains" name="T1550.002">inject.exe</Image><Image condition="contains" name="T1550.002">rundll32.exe</Image><Image condition="contains" name="T1550.002">psexec.exe</Image><Image condition="contains" name="T1550.002">wmic.exe</Image><Image condition="contains" name="T1550.002">net.exe</Image><Image condition="contains" name="T1550.002">dsquery.exe</Image><Image condition="contains" name="T1550.002">runas.exe</Image>
<CommandLine condition="contains any" name="T1550.003">sekurlsa::tickets;kerberos::ptt</CommandLine>
<Image condition="contains" name="T1550.003">mimikatz.exe</Image><Image condition="contains" name="T1550.003">rubeus.exe</Image><Image condition="contains" name="T1550.003">inject.exe</Image><Image condition="contains" name="T1550.003">rundll32.exe</Image><Image condition="contains" name="T1550.003">psexec.exe</Image><Image condition="contains" name="T1550.003">wmic.exe</Image><Image condition="contains" name="T1550.003">net.exe</Image><Image condition="contains" name="T1550.003">dsquery.exe</Image><Image condition="contains" name="T1550.003">runas.exe</Image>
<Image condition="contains" name="T1021.001">mstsc.exe</Image>
<ParentImage condition="image" name="T1021.002">powershell.exe</ParentImage>
<Image condition="image" name="T1021.002">net.exe</Image><Image condition="image" name="T1021.002">net.exe</Image>
<OriginalFileName condition="contains any" name="T1204.002">.doc;.pdf;.xls;.rtf;.scr;.exe;.lnk;.pif;.cp</OriginalFileName><OriginalFileName condition="contains any" name="T1204.002">.acm;.ax;.cpl;.dll;.drv;.efi;.exe;.mui;.ocx;.scr;.sys;.tsp;.pptx;.ppt;.one</OriginalFileName>
<ParentImage condition="image" name="T1566.001">powershell.exe</ParentImage><ParentImage condition="image" name="T1566.001">cmd.exe</ParentImage>
<CommandLine condition="contains all" name="T1078.001">net;user;guest;/active:yes</CommandLine><CommandLine condition="contains all" name="T1078.001">net;user;guest</CommandLine>
<Rule groupRelation="and" name="T1078.001">
<CommandLine condition="contains all">guest;/add</CommandLine>
<Image condition="is">net.exe</Image>
</Rule>
<Rule groupRelation="and" name="T1569.002">
<Image condition="contains">net.exe</Image>
<CommandLine condition="contains any">start;stop;pause;continue</CommandLine>
</Rule>
<Image condition="contains" name="T1569.002">sc.exe</Image><Image condition="contains" name="T1569.002">PsExec.exe</Image><Image condition="contains" name="T1569.002">psexec.py</Image>
<CommandLine condition="contains all" name="T1134.001">start;timeout /t 3&gt;nul&amp;&amp;echo</CommandLine>
<CommandLine condition="contains any" name="T1136.002">net user;/add /domain</CommandLine>
<OriginalFileName condition="contains any" name="T1136.002">net.exe;net1.exe</OriginalFileName>
</ProcessCreate>
</RuleGroup><RuleGroup groupRelation="or" name="3_include">
<NetworkConnect onmatch="include">
<DestinationPort condition="is" name="T1558.001">88</DestinationPort><DestinationPort condition="is" name="T1558.001">464</DestinationPort><DestinationPort condition="is" name="T1550.003">88</DestinationPort><DestinationPort condition="is" name="T1550.003">464</DestinationPort>
<DestinationPort condition="is" name="T1021.001">22</DestinationPort><DestinationPort condition="is" name="T1021.001">23</DestinationPort><DestinationPort condition="is" name="T1021.001">22</DestinationPort><DestinationPort condition="is" name="T1021.001">23</DestinationPort><DestinationPort condition="is" name="T1021.001">3389</DestinationPort><DestinationPort condition="is" name="T1021.001">5800</DestinationPort><DestinationPort condition="is" name="T1021.001">5900</DestinationPort><DestinationPort condition="is" name="T1021.001">5985</DestinationPort><DestinationPort condition="is" name="T1021.001">5986</DestinationPort>
<Image condition="image" name="T1021.001">vnc.exe</Image><Image condition="image" name="T1021.001">vncviewer.exe</Image><Image condition="image" name="T1021.001">vncservice.exe</Image><Image condition="image" name="T1021.001">omniinet.exe</Image><Image condition="image" name="T1021.001">hpsmhd.exe</Image>
</NetworkConnect>
</RuleGroup><RuleGroup groupRelation="or" name="5_include">
<ProcessTerminate onmatch="include">
<Image condition="contains" name="T1558.001">mimikatz.exe</Image><Image condition="contains" name="T1550.003">mimikatz.exe</Image>
</ProcessTerminate>
</RuleGroup><RuleGroup groupRelation="or" name="7_include">
<ImageLoad onmatch="include">
<ImageLoaded condition="contains any" name="T1558.001">mimikatz.dll;mimilib.dll;krb5_32.dll;krb5_64.dll;mimikatz.exe</ImageLoaded><Rule groupRelation="and" name="T1055.001">  <Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.001">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
</Rule><Rule groupRelation="and" name="T1055.001">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.001">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.001">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.001">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.001">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.001">
<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image> <ImageLoaded condition="begin with">C:\Windows\assembly\</ImageLoaded>
</Rule><Rule groupRelation="and" name="T1055.001">
<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image> <ImageLoaded condition="begin with">C:\Windows\Microsoft.NET\assembly\GAC_MSIL</ImageLoaded> </Rule><Rule groupRelation="and" name="T1055.001">
<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image> <OriginalFileName condition="is">clr.dll</OriginalFileName> </Rule>
<OriginalFileName condition="is" name="T1055.001">clr.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.001">clrjit.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.001">mscoreei.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.001">mscoree.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.001">mscoreeis.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.001">mscorlib.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.001">mscorlib.ni.dll</OriginalFileName>
<Rule groupRelation="and" name="T1055.012">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image>
</Rule><Rule groupRelation="and" name="T1055.012">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.012">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.012">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.012">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.012">

<Image condition="excludes">C:\Windows\Microsoft.NET\</Image> </Rule><Rule groupRelation="and" name="T1055.012">
<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image> <ImageLoaded condition="begin with">C:\Windows\assembly\</ImageLoaded>
</Rule><Rule groupRelation="and" name="T1055.012">
<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image> <ImageLoaded condition="begin with">C:\Windows\Microsoft.NET\assembly\GAC_MSIL</ImageLoaded> </Rule><Rule groupRelation="and" name="T1055.012">
<Image condition="contains all">C:\Program Files;\Microsoft Office\root\Office</Image> <OriginalFileName condition="is">clr.dll</OriginalFileName> </Rule>
<OriginalFileName condition="is" name="T1055.012">clrjit.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.012">mscoreei.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.012">mscoree.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.012">mscoreeis.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.012">mscorlib.dll</OriginalFileName><OriginalFileName condition="is" name="T1055.012">mscorlib.ni.dll</OriginalFileName>
<ImageLoaded condition="contains any" name="T1550.003">mimikatz.dll;mimilib.dll;krb5_32.dll;krb5_64.dll;mimikatz.exe</ImageLoaded>
</ImageLoad>
</RuleGroup><RuleGroup groupRelation="or" name="8_include">
<CreateRemoteThread onmatch="include">
<SourceImage condition="begin with" name="T1055.001">C:\</SourceImage><SourceImage condition="begin with" name="T1055.001">\\</SourceImage><SourceImage condition="begin with" name="T1055.012">C:\</SourceImage><SourceImage condition="begin with" name="T1055.012">\\</SourceImage>
</CreateRemoteThread>
</RuleGroup><RuleGroup groupRelation="or" name="10_include">
<ProcessAccess onmatch="include">
<Rule groupRelation="and" name="T1055.001">
<SourceImage condition="contains all">C:\Program Files;\Microsoft Office\Root\Office</SourceImage>
<CallTrace condition="contains">\Microsoft Shared\VBA</CallTrace> </Rule><Rule groupRelation="and" name="T1055.001">
<CallTrace condition="not begin with">C:\Windows\SYSTEM32\ntdll.dll</CallTrace>
<CallTrace condition="not begin with">C:\Windows\SYSTEM32\win32u.dll</CallTrace>
<CallTrace condition="not begin with">C:\Windows\SYSTEM32\wow64win.dll</CallTrace>
</Rule><GrantedAccess name="T1055.001">0x820</GrantedAccess><GrantedAccess name="T1055.001">0x21410</GrantedAccess><GrantedAccess name="T1055.001">0x0800</GrantedAccess><GrantedAccess name="T1055.001">0x800</GrantedAccess>
<Rule groupRelation="and" name="T1055.012">
<SourceImage condition="contains all">C:\Program Files;\Microsoft Office\Root\Office</SourceImage>
<CallTrace condition="contains">\Microsoft Shared\VBA</CallTrace> </Rule><Rule groupRelation="and" name="T1055.012">



</Rule>
<GrantedAccess name="T1055.012">0x820</GrantedAccess><GrantedAccess name="T1055.012">0x21410</GrantedAccess><GrantedAccess name="T1055.012">0x0800</GrantedAccess><GrantedAccess name="T1055.012">0x800</GrantedAccess>
<CallTrace condition="not begin with" name="T1055.012">C:\Windows\SYSTEM32\ntdll.dll</CallTrace><CallTrace condition="not begin with" name="T1055.012">C:\Windows\SYSTEM32\win32u.dll</CallTrace><CallTrace condition="not begin with" name="T1055.012">C:\Windows\SYSTEM32\wow64win.dll</CallTrace>
<TargetImage condition="is" name="T1550.002">C:\Windows\system32\lsass.exe</TargetImage>
<TargetImage condition="is" name="T1550.003">C:\Windows\system32\lsass.exe</TargetImage>
</ProcessAccess>
</RuleGroup><RuleGroup groupRelation="or" name="11_include">
<FileCreate onmatch="include">
<TargetFilename condition="end with" name="T1558.001">golden.bat</TargetFilename><Image condition="contains" name="T1550.003">mimikatz.exe</Image>
<TargetFilename condition="end with" name="T1550.003">.kirbi</TargetFilename>
<Image condition="contains any" name="T1189">firefox.exe;chrome.exe;edge.exe</Image>
</FileCreate>
</RuleGroup><RuleGroup groupRelation="or" name="12_13_14_include">
<RegistryEvent onmatch="include">
<TargetObject condition="contains" name="T1133">HKLM\Software\Wow6432Node\Google\Chrome\Extensions\</TargetObject><TargetObject condition="contains" name="T1547.001">\CurrentVersion\Run</TargetObject><TargetObject condition="contains" name="T1547.001">\Policies\Explorer\Run</TargetObject><TargetObject condition="contains all" name="T1547.001">HKLM\SYSTEM\;Control\Session Manager\BootExecute</TargetObject><TargetObject condition="contains all" name="T1547.001">HKLM\SYSTEM\;Control\Session Manager\excludefromknowndlls</TargetObject><TargetObject condition="contains all" name="T1547.001">HKLM\SYSTEM\;Control\Session Manager\safedllsearchmode</TargetObject><TargetObject condition="contains all" name="T1547.001">HKLM\SYSTEM\;Control\Session Manager\setupexecute</TargetObject><TargetObject condition="contains" name="T1547.001">Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\Startup</TargetObject><TargetObject condition="contains all" name="T1547.001">software\microsoft\windows nt\currentversion\accessibility\ATs\;\StartExe</TargetObject><TargetObject condition="contains" name="T1547.001">software\microsoft\windows nt\currentversion\windows\run\</TargetObject><TargetObject condition="contains" name="T1547.001">Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU\</TargetObject><TargetObject condition="contains" name="T1547.001">software\microsoft\windows\currentversion\explorer\shell folders\common startup</TargetObject><TargetObject condition="contains" name="T1547.001">software\microsoft\windows\currentversion\explorer\shell folders\startup</TargetObject><TargetObject condition="begin with" name="T1547.001">hklm\software\microsoft\command processor\autorun</TargetObject><TargetObject condition="begin with" name="T1547.001">HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp\InitialProgram</TargetObject>
<TargetObject condition="contains" name="T1558.001">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions{7b849a69-220f-451e-b3f3-2cb811d7d4ae}</TargetObject><TargetObject condition="contains" name="T1558.001">HKLM\SECURITY\Policy\Secrets</TargetObject><TargetObject condition="contains" name="T1558.001"> HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\LogonUI\SessionData</TargetObject><TargetObject condition="contains" name="T1558.001">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Providers{e48525c0-4e5b-4b4d-9b4d-4b8bbe50ba4b}</TargetObject><TargetObject condition="contains" name="T1558.001">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Providers{e48525c0-4e5b-4b4d-9b4d-4b8bbe50ba4b}\Kerberos</TargetObject>
<TargetObject condition="contains" name="T1550.003">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions{7b849a69-220f-451e-b3f3-2cb811d7d4ae}</TargetObject><TargetObject condition="contains" name="T1550.003">HKLM\SECURITY\Policy\Secrets</TargetObject><TargetObject condition="contains" name="T1550.003"> HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\LogonUI\SessionData</TargetObject><TargetObject condition="contains" name="T1550.003">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Providers{e48525c0-4e5b-4b4d-9b4d-4b8bbe50ba4b}</TargetObject><TargetObject condition="contains" name="T1550.003">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Providers{e48525c0-4e5b-4b4d-9b4d-4b8bbe50ba4b}\Kerberos</TargetObject>
<TargetObject condition="is" name="T1021.001">HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\MaxInstanceCount</TargetObject><TargetObject condition="is" name="T1021.001">HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services\RaunSolicit</TargetObject>
<TargetObject condition="contains" name="T1569.002">HKLM\SYSTEM\CurrentControlSet\Services</TargetObject><TargetObject condition="contains" name="T1569.002">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</TargetObject><TargetObject condition="contains" name="T1569.002">HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</TargetObject><TargetObject condition="contains" name="T1569.002">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</TargetObject><TargetObject condition="contains" name="T1569.002">HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</TargetObject>
</RegistryEvent>
</RuleGroup><RuleGroup groupRelation="or" name="15_include">
<FileCreateStreamHash onmatch="include">
<Rule groupRelation="and" name="T1189">
<TargetFilename condition="end with">:Zone.Identifier</TargetFilename>
<Contents condition="contains any">blob:;about:internet;ZoneId=3</Contents>
</Rule></FileCreateStreamHash>
</RuleGroup><RuleGroup groupRelation="or" name="22_include">
<DnsQuery onmatch="include">
<Rule groupRelation="and" name="T1133">


</Rule><Image condition="contains" name="T1133">chrome.exe</Image>
<QueryName condition="contains" name="T1133">wpad</QueryName>
<QueryName condition="contains" name="T1566.001">github.com</QueryName>
</DnsQuery>
</RuleGroup></EventFiltering>
</Sysmon>